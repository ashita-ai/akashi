# Akashi environment — binary-only mode.
#
# Copy to .env in the repo root, then fill in your values:
#   cp docker/env.example .env
#
# Used by: docker compose up -d  (docker-compose.yml, binary-only)
# For the complete local stack (no external services needed), use:
#   docker compose -f docker-compose.complete.yml up -d
# The complete stack wires all services automatically — no .env needed.

# ──────────────────────────────────────────────────────────────
# Database (required)
# TimescaleDB 18 with pgvector and TimescaleDB extensions.
# The extensions must be pre-installed — see docker/init.sql.
# ──────────────────────────────────────────────────────────────

DATABASE_URL=postgres://user:password@host:5432/akashi?sslmode=require
# NOTIFY_URL defaults to DATABASE_URL. Set separately if using a connection pooler
# (PgBouncer) for queries — LISTEN/NOTIFY requires a direct connection.
# NOTIFY_URL=postgres://user:password@host:5432/akashi?sslmode=require

# ──────────────────────────────────────────────────────────────
# Admin API key (required)
# Bootstrap key for the initial admin agent. Change this.
# ──────────────────────────────────────────────────────────────

AKASHI_ADMIN_API_KEY=changeme

# ──────────────────────────────────────────────────────────────
# Qdrant vector search (optional)
# Without Qdrant, semantic search falls back to PostgreSQL full-text search.
# ──────────────────────────────────────────────────────────────

QDRANT_URL=https://your-cluster.cloud.qdrant.io:6333
QDRANT_API_KEY=
# QDRANT_COLLECTION=akashi_decisions

# ──────────────────────────────────────────────────────────────
# Embeddings (optional)
# Without an embedding provider, semantic search and conflict detection
# are disabled. Text search still works.
#
# Auto-detection order: Ollama (if reachable) → OpenAI (if key set) → noop.
# Override with AKASHI_EMBEDDING_PROVIDER=openai|ollama|noop|auto
# ──────────────────────────────────────────────────────────────

# OpenAI (recommended for cloud deployments):
OPENAI_API_KEY=
# AKASHI_EMBEDDING_MODEL=text-embedding-3-small
# AKASHI_EMBEDDING_DIMENSIONS=1024

# Ollama (for self-hosted / air-gapped):
# OLLAMA_URL=http://your-ollama-host:11434
# OLLAMA_MODEL=mxbai-embed-large
# AKASHI_EMBEDDING_PROVIDER=ollama

# ──────────────────────────────────────────────────────────────
# LLM conflict validation (optional)
# Reduces conflict false positives by ~93%. Requires OpenAI key or an Ollama
# model capable of instruction following (e.g. qwen2.5:7b).
# When OPENAI_API_KEY is set, gpt-4o-mini is used automatically.
# Set to an Ollama model name to use local LLM validation instead.
# ──────────────────────────────────────────────────────────────

# AKASHI_CONFLICT_LLM_MODEL=qwen2.5:7b

# ──────────────────────────────────────────────────────────────
# JWT signing keys (optional — ephemeral if unset)
# Without these, a new key pair is generated each restart, invalidating
# all existing tokens and browser sessions.
#
# Generate persistent keys (requires openssl):
#   mkdir -p data
#   openssl genpkey -algorithm ed25519 -out data/jwt_private.pem
#   openssl pkey -in data/jwt_private.pem -pubout -out data/jwt_public.pem
# Then mount ./data:/data in docker-compose.yml and set these paths.
# ──────────────────────────────────────────────────────────────

# AKASHI_JWT_PRIVATE_KEY=/data/jwt_private.pem
# AKASHI_JWT_PUBLIC_KEY=/data/jwt_public.pem
# AKASHI_JWT_EXPIRATION=24h

# ──────────────────────────────────────────────────────────────
# Server
# ──────────────────────────────────────────────────────────────

# AKASHI_PORT=8080
# AKASHI_LOG_LEVEL=info

# ──────────────────────────────────────────────────────────────
# Observability (optional)
# ──────────────────────────────────────────────────────────────

# OTEL_EXPORTER_OTLP_ENDPOINT=
# OTEL_SERVICE_NAME=akashi
